<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/rss2.xml" title="Leon Mak" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Leon Mak">
<meta property="og:url" content="http://leonmak.me/page/2/index.html">
<meta property="og:site_name" content="Leon Mak">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Leon Mak">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> Leon Mak </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-87678896-1', 'auto');
  ga('send', 'pageview');
</script>





  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Leon Mak</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-projects">
          <a href="/projects" rel="section">
            
              <i class="menu-item-icon fa fa-gift fa-fw"></i> <br />
            
            projects
          </a>
        </li>
      
        
        <li class="menu-item menu-item-design">
          <a href="/design" rel="section">
            
              <i class="menu-item-icon fa fa-paint-brush fa-fw"></i> <br />
            
            design
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">

    

    
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/11/Twemojis-for-React-Mapbox-gl/" itemprop="url">
                  Twemojis for React & Mapbox gl
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Posted on
            <time itemprop="dateCreated" datetime="2016-09-11T14:39:25+08:00" content="2016-09-11">
              2016-09-11
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/09/11/Twemojis-for-React-Mapbox-gl/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/09/11/Twemojis-for-React-Mapbox-gl/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Emoji-Problem"><a href="#Emoji-Problem" class="headerlink" title="Emoji Problem"></a>Emoji Problem</h1><p>So my group decided on doing an app using emoji’s and mapbox, it’s Pokemon Go for chat where you (or businesses) could drop and discover messages (mockup screenshots below) around you. Well apparently you need to <a href="https://www.mapbox.com/help/custom-markers/" target="_blank" rel="external">upload images to Mapbox Studio for custom marker icons in MapboxGL</a>, the only other custom image (using css) was the user’s avartar which updated on map move rather than as a marker property. We thought we could upload all 1200+ emoji / 874 twemoji svg files and be done (they were only 1mb, why not?), but strangely there was an (AFAIK) undocumented 500 sprite limit. </p>
<h1 id="Lesser-is-better"><a href="#Lesser-is-better" class="headerlink" title="Lesser is better"></a>Lesser is better</h1><p>Anyway emojis like flags and letters would not be too relevant for our purposes, so we just had to choose which emojis we would support. Based on <a href="http://emojitracker.com/" target="_blank" rel="external">http://emojitracker.com/</a> we thought that using the people + objects categories (425 twemojis) would cover well enough ground for people to post their reactions and activities.</p>
<h1 id="How-to-get-the-files"><a href="#How-to-get-the-files" class="headerlink" title="How to get the files"></a>How to get the files</h1><p>The next step was to upload the svgs. To choose a subset of <a href="https://github.com/twitter/twemoji" target="_blank" rel="external">twemojis</a> to upload to Mapbox Studio and to use with <a href="https://github.com/chadoh/react-emoji-picker" target="_blank" rel="external">react-emoji-picker</a> in our app, I had to first get the list of twemojis we would support on the emoji picker. There was a category to name mapping, then there was a name to unicode mapping, put the two together and a script and tada I got the files, here’s <a href="https://github.com/leonmak/twemoji-filter" target="_blank" rel="external">the repo</a>.</p>
<h1 id="Mockups-of-our-app"><a href="#Mockups-of-our-app" class="headerlink" title="Mockups of our app"></a>Mockups of our app</h1><div class="group-picture"><div class="group-picture-container"><div class="group-picture-row"><div class="group-picture-column" style="width: 33.333333333333336%;"><a href="http://res.cloudinary.com/leonmak/image/upload/v1473578344/drop/List.png" class="fancybox" rel="external" target="_blank"><img src="http://res.cloudinary.com/leonmak/image/upload/v1473578344/drop/List.png" alt=""></a></div><div class="group-picture-column" style="width: 33.333333333333336%;"><a href="http://res.cloudinary.com/leonmak/image/upload/c_scale,w_421/v1473578345/drop/Map.jpg" class="fancybox" rel="external" target="_blank"><img src="http://res.cloudinary.com/leonmak/image/upload/c_scale,w_421/v1473578345/drop/Map.jpg" alt=""></a></div><div class="group-picture-column" style="width: 33.333333333333336%;"><a href="http://res.cloudinary.com/leonmak/image/upload/v1473578343/drop/Drop_group.png" class="fancybox" rel="external" target="_blank"><img src="http://res.cloudinary.com/leonmak/image/upload/v1473578343/drop/Drop_group.png" alt=""></a></div></div><div class="group-picture-row"></div></div></div>
<h2 id="What-it-looks-like-now"><a href="#What-it-looks-like-now" class="headerlink" title="What it looks like now"></a>What it looks like now</h2><div class="group-picture"><div class="group-picture-container"><div class="group-picture-row"><div class="group-picture-column" style="width: 33.333333333333336%;"><a href="http://res.cloudinary.com/leonmak/image/upload/v1473662951/drop/Screenshot_2016-09-12_14.47.11.png" class="fancybox" rel="external" target="_blank"><img src="http://res.cloudinary.com/leonmak/image/upload/v1473662951/drop/Screenshot_2016-09-12_14.47.11.png" alt=""></a></div><div class="group-picture-column" style="width: 33.333333333333336%;"><a href="http://res.cloudinary.com/leonmak/image/upload/v1473662951/drop/Screenshot_2016-09-12_14.48.29.png" class="fancybox" rel="external" target="_blank"><img src="http://res.cloudinary.com/leonmak/image/upload/v1473662951/drop/Screenshot_2016-09-12_14.48.29.png" alt=""></a></div><div class="group-picture-column" style="width: 33.333333333333336%;"><a href="http://res.cloudinary.com/leonmak/image/upload/v1473662952/drop/Screenshot_2016-09-12_14.46.05.png" class="fancybox" rel="external" target="_blank"><img src="http://res.cloudinary.com/leonmak/image/upload/v1473662952/drop/Screenshot_2016-09-12_14.46.05.png" alt=""></a></div></div><div class="group-picture-row"></div></div></div>
<h3 id="Edit-Check-it-out-https-drop-dev-surge-sh"><a href="#Edit-Check-it-out-https-drop-dev-surge-sh" class="headerlink" title="Edit: Check it out - https://drop-dev.surge.sh/"></a>Edit: Check it out - <a href="https://drop-dev.surge.sh/" target="_blank" rel="external">https://drop-dev.surge.sh/</a></h3>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/30/Application-Critique-Discord/" itemprop="url">
                  Application critque - Discord
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Posted on
            <time itemprop="dateCreated" datetime="2016-08-30T18:04:13+08:00" content="2016-08-30">
              2016-08-30
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/08/30/Application-Critique-Discord/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/08/30/Application-Critique-Discord/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Have-a-rival"><a href="#Have-a-rival" class="headerlink" title="Have a rival"></a>Have a rival</h1><p>The title on <a href="https://discordapp.com/" target="_blank" rel="external">Discord’s landing page</a> is “It’s time to ditch Skype and TeamSpeak.” For gamers used to these services, it sends a clear signal that Discord is promising to do better.<br><img src="http://res.cloudinary.com/leonmak/image/upload/v1472562905/Screenshot_2016-08-30_20.22.52_rrnuwn.png" alt=""></p>
<p>The group’s discussion of Discord positioning themselves as a competitor to other VOIP apps reminded me of a blog article I read about how <a href="https://blog.codinghorror.com/whos-your-arch-enemy/" target="_blank" rel="external">Jeff Atwood of Stack Overflow saw Experts-Exchange as its arch-enemy</a>, when he wrote </p>
<blockquote>
<p>by far the most effective way to explain what we do – is this:<br>We’re like experts-exchange, but without all the evil.</p>
</blockquote>
<p>I feel that it’s important for apps to do this especially if the technology may be foreign to some. Saying that “X is the better version of Y” is a stronger comparison than the (<em>cliched?</em>) advice associating a product as the “X of Y”. </p>
<p>Having a point of reference is easier than having to imagine an entirely new product.</p>
<p>In retrospect, personally many apps I’ve used have a similar argument, for example, NUSmods vs other calendars, NUSwhispers vs NUSconfessions, etc. even if they did not explicitly state it.</p>
<h1 id="Thoughts"><a href="#Thoughts" class="headerlink" title="Thoughts"></a>Thoughts</h1><p>I feel that looking at weaker or ‘defective’ products is another way to ideate. By looking at ‘pain points’, rather than predicting users’ needs, we can find areas where demand is already present but not met. </p>
<p>To relate this to the presentation my group did about Periscope, the CEO of Meerkat (a rival app which ditched live-streaming), explains the <a href="http://www.recode.net/2016/3/4/11586696/meerkat-is-ditching-the-livestream-and-chasing-a-video-social-network" target="_blank" rel="external">challenge with using new technology like live-streaming</a> - </p>
<blockquote>
<p>Before Instagram, people already knew what constituted a beautiful photo and tried to take them. With live video no one really knows what ‘good’ live video they can create is.”</p>
</blockquote>
<p>Perhaps it also would have been a better choice to pick an app/tech that everyone in class was familiar with, as we had to spend time explaining the app to everyone.</p>
<p><em>An aside: Like Ash and Gary, rivalry is relatable</em><br><img src="http://res.cloudinary.com/leonmak/image/upload/c_scale,w_270/v1472559150/Ash-and-Gary-ash-ketchum-10888934-985-615_8589_nn1bho.jpg" alt=""></p>
<h1 id="Be-the-very-best-that-no-one-ever-was"><a href="#Be-the-very-best-that-no-one-ever-was" class="headerlink" title="Be the very best, that no one ever was"></a>Be the very best, that no one ever was</h1><p>Discord also makes it very clear what they are best at - chat, and for who - gamers. From their logo being a speech bubble, to their focus on live chat (text and voice, and on different platforms), the group identified the niche that Discord targets - communication between gamers. I felt that this was an important point, as Discord understands gamers’ unique pains and offers them ‘painkillers’ - from a fuss-free setup (for non-technical gamers), voice chat that has the lowest cpu consumption doesn’t make you lag, to the in-game chat where you don’t need to switch to the chat application.<br><img src="http://res.cloudinary.com/leonmak/image/upload/c_scale,w_270/v1472559368/Screenshot_2016-08-30_20.15.13_slnjxl.png" alt=""></p>
<p>Compared to services like skype and teamspeak, which cater to groups other than gamers, like business and educational content, Discord stands out clearly. Differentiating themselves clearly from their competitors and directly addressing gamer-specific needs allows Discord to quickly gain a loyal following.</p>
<h1 id="Thoughts-1"><a href="#Thoughts-1" class="headerlink" title="Thoughts"></a>Thoughts</h1><p>The founders being avid gamers themselves know their users inside out, and more than met the technical challenges of in-game communication. I feel that part of the reason why NUS apps like NUSmods and NUSwhispers have succeeded is that the developers themselves were the users and this gave them a deeper understanding of the needs of their users.</p>
<h1 id="Gotta-catch-‘em-all"><a href="#Gotta-catch-‘em-all" class="headerlink" title="Gotta catch ‘em all!"></a>Gotta catch ‘em all!</h1><p>Discord goes further than solving their users’ needs but also relates to them as gamers on an emotional level. I would argue that although this is subjective it is clear to me their users feel they are being understood. As Zhi An from the group pointed out during the Q&amp;A, from their website to the loading screen backgrounds, to small details like their cute graphics are things that are easily relatable to users who identify themselves as gamers.</p>
<p>I feel that it is important to ‘make something users love’, as the result for Discord is a user base that is very supportive of their efforts. Some even <a href="https://www.reddit.com/r/discordapp/comments/4d96pa/top_7_reasons_to_use_discord/" target="_blank" rel="external">encourage other gamers</a> to use Discord because they like it so much. This much desired ‘organic growth’ I think comes only when users can feel that the app is a part of their own identy that they are willing to promote it, something which discord manages to do through their love for online gaming. </p>
<p><em>Another aside: like Ash, you don’t need to catch pokemon if you can become their friends.</em><br><img src="http://res.cloudinary.com/leonmak/image/upload/c_scale,w_270/v1472562906/Screenshot_2016-08-30_21.14.52_nkqyxy.png" alt=""></p>
<h1 id="Other-thoughts"><a href="#Other-thoughts" class="headerlink" title="Other thoughts"></a>Other thoughts</h1><p>I felt that some suggestions the group had about recording music and presentations diluted the main message that Discord was ‘for gamers by gamers’, and also for that reason they are unlikely to be targetting slack though their UI looks the same and some features overlap. As a gamer the key feature I would want is free and fast VOIP chat and slack really excels more for work related tasks like using integrations and file-sharing.</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/23/Mockups-to-Building-to-Mockups/" itemprop="url">
                  From mockups to building to mockups
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Posted on
            <time itemprop="dateCreated" datetime="2016-08-23T07:05:43+08:00" content="2016-08-23">
              2016-08-23
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/08/23/Mockups-to-Building-to-Mockups/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/08/23/Mockups-to-Building-to-Mockups/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>The following is our process thus far for developing the exchange buddy web app:</p>
<h2 id="From-Ideas-to-Paper"><a href="#From-Ideas-to-Paper" class="headerlink" title="From Ideas to Paper"></a>From Ideas to Paper</h2><p>After discussing as a team, we decided to go with the exchange buddy idea. Our first step was to list down the features we thought exchange students, or ourselves, would want. Eugene already had a simple wordpress site he built for exchangebuddy.com, and it was insightful to hear his view on the needs of exchange students, something I myself had not yet considered (being year 2, probably I should). Mainly the gap we identified was that exchange students who do not go to places with their friends do look for others who are going on exchange to the same university with them. Normally there would be a google form where people would fill in their contacts and people could view who else were going to that university, or a facebook group (for example: Singaporeans in Cambridge). </p>
<p>Also issues like accomodation, information or paperwork (for example: rules for visa holders setting up bank account) were some of the common pain points we got from talking to our friends who as of this writing had just left for exchange, which corroborated Eugene’s research from exchange buddy.</p>
<h2 id="From-Paper-to-Sketch"><a href="#From-Paper-to-Sketch" class="headerlink" title="From Paper to Sketch"></a>From Paper to Sketch</h2><p>We then made simple paper prototypes (or on whiteboard) where we threw around ideas and layouts.</p>
<p>I then made a few mockups thinking of the components we would use. Pictures speak louder than words so:</p>
<div class="group-picture"><div class="group-picture-container"><div class="group-picture-row"><div class="group-picture-column" style="width: 33.333333333333336%;"><a href="http://res.cloudinary.com/leonmak/image/upload/v1471907440/Group_Page_Wiki_wzjtdd.png" class="fancybox" rel="external" target="_blank"><img src="http://res.cloudinary.com/leonmak/image/upload/v1471907440/Group_Page_Wiki_wzjtdd.png" alt=""></a></div><div class="group-picture-column" style="width: 33.333333333333336%;"><a href="http://res.cloudinary.com/leonmak/image/upload/v1471907440/Group_Page_Chat_s3pwzy.png" class="fancybox" rel="external" target="_blank"><img src="http://res.cloudinary.com/leonmak/image/upload/v1471907440/Group_Page_Chat_s3pwzy.png" alt=""></a></div><div class="group-picture-column" style="width: 33.333333333333336%;"><a href="http://res.cloudinary.com/leonmak/image/upload/v1471907441/Tips_Page_hfx4rr.png" class="fancybox" rel="external" target="_blank"><img src="http://res.cloudinary.com/leonmak/image/upload/v1471907441/Tips_Page_hfx4rr.png" alt=""></a></div></div><div class="group-picture-row"></div></div></div>
<p>After a few rounds of discussion our features changed, for example we didn’t think a listing of other university exchange groups would be that important. Also the grid layout for tips became more of a list.</p>
<div class="group-picture"><div class="group-picture-container"><div class="group-picture-row"><div class="group-picture-column" style="width: 33.333333333333336%;"><a href="http://res.cloudinary.com/leonmak/image/upload/v1471907440/Group_Info_uoajdk.png" class="fancybox" rel="external" target="_blank"><img src="http://res.cloudinary.com/leonmak/image/upload/v1471907440/Group_Info_uoajdk.png" alt=""></a></div><div class="group-picture-column" style="width: 33.333333333333336%;"><a href="http://res.cloudinary.com/leonmak/image/upload/v1471907461/Group_Chat_apm2pc.png" class="fancybox" rel="external" target="_blank"><img src="http://res.cloudinary.com/leonmak/image/upload/v1471907461/Group_Chat_apm2pc.png" alt=""></a></div><div class="group-picture-column" style="width: 33.333333333333336%;"><a href="http://res.cloudinary.com/leonmak/image/upload/v1471907462/Group_News_wfldyj.png" class="fancybox" rel="external" target="_blank"><img src="http://res.cloudinary.com/leonmak/image/upload/v1471907462/Group_News_wfldyj.png" alt=""></a></div></div><div class="group-picture-row"><div class="group-picture-column" style="width: 100%;"><a href="http://res.cloudinary.com/leonmak/image/upload/v1471907470/Group_Info_rrz7u0.png" class="fancybox" rel="external" target="_blank"><img src="http://res.cloudinary.com/leonmak/image/upload/v1471907470/Group_Info_rrz7u0.png" alt=""></a></div></div></div></div>
<p>I’ve been using Sketch for a while after my photoshop had expired and I actually rarely had to go back unless I’m working with heavy textures for which Sketch being vector-based is not the best for. But I’m quite biased toward it because I feel it’s less bloated and hangs less on my Macbook Air. Also I can easily export images without having to scale the artboard beforehand so it’s always so crisp, a plus for viewing/ printing. There are also resources like <a href="http://sketchappsources.com" target="_blank" rel="external">sketchappsources.com</a> where many talented designers post their work, much respect to them!</p>
<h2 id="From-Sketch-to-React"><a href="#From-Sketch-to-React" class="headerlink" title="From Sketch to React"></a>From Sketch to React</h2><p>To build our prototype for the mid-submission, we relied on libraries like material-ui to provide components like cards that we could use, which by default looks ‘better’ than bootstrap. After getting some feedback from tutors and students we also decided that news itself would be quite irrelevant and local events would suit the students need better.</p>
<p>Other React components we needed were also available which meant Irvin could also focus on what I saw as the hard part which was the backend where we were going for ‘Reactive MySQL’, ie. using meteor’s pub sub features with MySQL as our database for real-time updates. Meanwhile I just mocked the data although Thanh and Irvin had made a schema it made developing easier without having to worry about the backend for now.</p>
<p>So as of mid-submission we got most of the layout up and it looks as such:<br><div class="group-picture"><div class="group-picture-container"><div class="group-picture-row"><div class="group-picture-column" style="width: 33.333333333333336%;"><a href="http://res.cloudinary.com/leonmak/image/upload/v1471912017/Screenshot_2016-08-23_08.26.08_jptakn.png" class="fancybox" rel="external" target="_blank"><img src="http://res.cloudinary.com/leonmak/image/upload/v1471912017/Screenshot_2016-08-23_08.26.08_jptakn.png" alt=""></a></div><div class="group-picture-column" style="width: 33.333333333333336%;"><a href="http://res.cloudinary.com/leonmak/image/upload/v1471911401/screencapture-exchangebuddy-irvinlim-group-chat-1471907721545_qr13pk.png" class="fancybox" rel="external" target="_blank"><img src="http://res.cloudinary.com/leonmak/image/upload/v1471911401/screencapture-exchangebuddy-irvinlim-group-chat-1471907721545_qr13pk.png" alt=""></a></div><div class="group-picture-column" style="width: 33.333333333333336%;"><a href="http://res.cloudinary.com/leonmak/image/upload/v1471911402/screencapture-exchangebuddy-irvinlim-group-events-1471907730288_hmu7cz.png" class="fancybox" rel="external" target="_blank"><img src="http://res.cloudinary.com/leonmak/image/upload/v1471911402/screencapture-exchangebuddy-irvinlim-group-events-1471907730288_hmu7cz.png" alt=""></a></div></div><div class="group-picture-row"></div></div></div></p>
<h2 id="Back-to-Paper"><a href="#Back-to-Paper" class="headerlink" title="Back to Paper"></a>Back to Paper</h2><p>So after building the rough layout we decided to change the info tab and avatar menu as we felt that it didn’t really work out when we were building it. For example the list of cards were really not feasible if there were so many cards and each would be so big when expanded. We decided then to split it into a home tab and an info tab where each grid section linked to it’s own article, so it was more of the original grid layout. I felt that although some more work had to be done to reorder the layouts it was a necessary decision we had to make. So back to the drawing board for those parts:</p>
<div class="group-picture"><div class="group-picture-container"><div class="group-picture-row"><div class="group-picture-column" style="width: 50%;"><a href="http://res.cloudinary.com/leonmak/image/upload/v1471910218/IMG_20160823_075237_wrfdoi.jpg" class="fancybox" rel="external" target="_blank"><img src="http://res.cloudinary.com/leonmak/image/upload/v1471910218/IMG_20160823_075237_wrfdoi.jpg" alt=""></a></div><div class="group-picture-column" style="width: 50%;"><a href="http://res.cloudinary.com/leonmak/image/upload/v1471910218/IMG_20160823_075228_soj5yo.jpg" class="fancybox" rel="external" target="_blank"><img src="http://res.cloudinary.com/leonmak/image/upload/v1471910218/IMG_20160823_075228_soj5yo.jpg" alt=""></a></div></div><div class="group-picture-row"></div><div class="group-picture-row"></div></div></div>
<div class="group-picture"><div class="group-picture-container"><div class="group-picture-row"><div class="group-picture-column" style="width: 33.333333333333336%;"><a href="http://res.cloudinary.com/leonmak/image/upload/v1471937953/Group_Home_zo2zof.png" class="fancybox" rel="external" target="_blank"><img src="http://res.cloudinary.com/leonmak/image/upload/v1471937953/Group_Home_zo2zof.png" alt=""></a></div><div class="group-picture-column" style="width: 33.333333333333336%;"><a href="http://res.cloudinary.com/leonmak/image/upload/v1471937958/Group_Info_Grid_yd1mnz.png" class="fancybox" rel="external" target="_blank"><img src="http://res.cloudinary.com/leonmak/image/upload/v1471937958/Group_Info_Grid_yd1mnz.png" alt=""></a></div><div class="group-picture-column" style="width: 33.333333333333336%;"><a href="http://res.cloudinary.com/leonmak/image/upload/v1471937954/Group_Info_Page_bkbbzh.png" class="fancybox" rel="external" target="_blank"><img src="http://res.cloudinary.com/leonmak/image/upload/v1471937954/Group_Info_Page_bkbbzh.png" alt=""></a></div></div><div class="group-picture-row"></div></div></div>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/15/Saturday-workshop-reflections/" itemprop="url">
                  Saturday workshop reflections
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Posted on
            <time itemprop="dateCreated" datetime="2016-08-15T16:54:35+08:00" content="2016-08-15">
              2016-08-15
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/08/15/Saturday-workshop-reflections/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/08/15/Saturday-workshop-reflections/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="Reflections-on-Prof-Damith’s-presentation-about-presentations"><a href="#Reflections-on-Prof-Damith’s-presentation-about-presentations" class="headerlink" title="Reflections on Prof Damith’s presentation about presentations"></a>Reflections on Prof Damith’s presentation about presentations</h2><p>Prof Damith was quite engaging despite it being a saturday morning and everyone looking slightly tired and unresponsive. As Assignment 2 has a presentation component I feel that the tips he gave would be applicable, especially his emphasis that we would learn by taking initiative to follow up his on presentation, and that there really is no substitute for practice and taking action, which was quite a meta call to action. </p>
<p>Prof Damith gave us a high level overview into different aspects of presentations, and also introduced to us his ‘puma’ framework, which consisted of starting strongly with a punchline, considering “what’s in it for the user”, and a specific promise of a gain. And then considering the audiences’ desired actions, beliefs and knowledge to craft key points and evidences. </p>
<p>Keeping the user’s needs in mind helps us to prioritise the features we consider when we develop, so we can present a compelling argument to use our app in terms of the users’ benefit, and not just the features we develop. Of course if that user was the developer then that process would be easier, to get a real feel for the problem you would know it at least exists, even better if that developer can build it.</p>
<p>In terms of presentation visuals, I think he made a good case for appealing to emotions to make it memorable, and selling benefits instead of features, as that is what makes a difference to users. Also the way he contrasted between boring statistics like ‘1000GB of memory’ and ‘1000 hours of movies’ was a good reminder of how to craft a meaningful message to our audience. </p>
<h2 id="Deciding-on-which-framework-to-use-for-the-Facebook-app"><a href="#Deciding-on-which-framework-to-use-for-the-Facebook-app" class="headerlink" title="Deciding on which framework to use for the Facebook app"></a>Deciding on which framework to use for the Facebook app</h2><p>After experimenting with different boilerplates like <a href="https://github.com/kriasoft/react-starter-kit" target="_blank" rel="external">react-starter-kit</a>, our team decided against using the new boilerplates as we just did not have the time to figure out new tools like GraphQL, and risk getting stuck or wasting time getting familiar with new file structures. Also we had to spend an unknown amount of time learning new conventions and best practices of the tools and boilerplate. </p>
<p>We decided to use MeteorJS, React and Redux as Irvin and I had previous experience developing apps with it and our other developer Thanh picked up most of it relatively quickly. </p>
<p>Although we were required to submit a SQL schema and the official supported database was MongoDB, we could also use MySQL with Meteor. </p>
<p>We also chose React over Angular / Blaze for the rendering engine as there were front-end libraries like Material UI which provided us with components to use, helping us save the little time that we have to deliver a working prototype.</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/07/What-I-hope-to-learn-in-CS3216/" itemprop="url">
                  What I hope to learn in CS3216
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Posted on
            <time itemprop="dateCreated" datetime="2016-08-07T23:56:50+08:00" content="2016-08-07">
              2016-08-07
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/08/07/What-I-hope-to-learn-in-CS3216/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/08/07/What-I-hope-to-learn-in-CS3216/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h3 id="Pushing-myself-to-learn-more-quickly"><a href="#Pushing-myself-to-learn-more-quickly" class="headerlink" title="Pushing myself to learn more quickly"></a>Pushing myself to learn more quickly</h3><p>Being accepted into this module was unexpected for me, as I didn’t consider myself an experienced developer or developer, being year 2 this semester. I was uncertain about taking it at first but even though I know it is hard what I hope will carry me through is my desire and interest to learn how to better design and build web applications. Through this module I hope I will get better at learning itself, in that I can learn to learn better and faster about designing and developing web applications. </p>
<h3 id="Building-something-good"><a href="#Building-something-good" class="headerlink" title="Building something good"></a>Building something good</h3><p>Despite my inexperience, I hope to become more confident in my own skills, by becoming better at my craft! Although I know the learning doesn’t end with CS3216, I hope to build a web application that I can be proud of by the end of the module. And although we will be marketing it, hopefully the usefulness of the app will show for itself.</p>
<h3 id="Working-with-others"><a href="#Working-with-others" class="headerlink" title="Working with others"></a>Working with others</h3><p>I believe the people taking CS3216 all bring something unique to the table and I hope we can all learn things from one another. It will be interesting to see how having non-SoC students in the course will affect the development process. Lastly I hope not just to learn from them but also to learn more about my fellow students in NUS, even though those taking the course may be from different years and faculties, I hope we can all make some friends! </p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/11/Custom-colors-for-loklak/" itemprop="url">
                  Custom colors for loklak
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Posted on
            <time itemprop="dateCreated" datetime="2016-07-11T09:42:56+08:00" content="2016-07-11">
              2016-07-11
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/07/11/Custom-colors-for-loklak/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/11/Custom-colors-for-loklak/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>You can now customize the background and card colors on loklak walls!</p>
<p>Here’s how we did it:</p>
<p>First, we had to add extra fields to the wall schema:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> UserSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  apps: &#123;</span><br><span class="line">    wall: [&#123;</span><br><span class="line">      <span class="comment">// other options</span></span><br><span class="line">      cardBgColour: <span class="built_in">String</span>,</span><br><span class="line">      cardForeColour: <span class="built_in">String</span>,</span><br><span class="line">      wallBgColour: <span class="built_in">String</span>,</span><br></pre></td></tr></table></figure></p>
<p>Next, we had to add these extra options in the angular controller (wall.js) for the creation modal:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> initWallOptions = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  $scope.newWallOptions.wallBgColour = <span class="string">'#ecf0f5'</span>;</span><br><span class="line">  $scope.newWallOptions.cardBgColour = <span class="string">'#ffffff'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$scope.$watch(<span class="string">'newWallOptions.cardBgColour'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ($scope.newWallOptions.cardBgColour) &#123;</span><br><span class="line">    $scope.newWallOptions.cardForeColour = colourCalculator(hexToRgb($scope.newWallOptions.cardBgColour));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>The $watch function watches for any changes in the card background color and changes the cardForeColour / text color to be black or white depending on the bg color.</p>
<p>Now, we have to use the saved data in the wall display pages (display.html):<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-style</span>=<span class="value">"&#123;'background-color': wall.wallOptions.wallBgColour&#125;"</span> <span class="attribute">class</span>=<span class="value">"wall-container container-fluid"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"container content-container wall-body"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-switch</span> <span class="attribute">on</span>=<span class="value">"wall.wallOptions.layoutStyle"</span> <span class="attribute">ng-show</span>=<span class="value">"wall.statuses.length&gt;0"</span> <span class="attribute">ng-class</span>=<span class="value">"wall.wallOptions.showStatistics || wall.currentAnnoucement?'col-md-8':'col-md-12'"</span> <span class="attribute">masonry</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 1. Linear --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-switch-when</span>=<span class="value">"1"</span> <span class="attribute">linear</span> <span class="attribute">ng-repeat</span>=<span class="value">"status in wall.statuses"</span> <span class="attribute">open</span>=<span class="value">"wall.open"</span> <span class="attribute">data</span>=<span class="value">"status"</span> </span><br><span class="line">            <span class="attribute">cardbgcolor</span>=<span class="value">"wall.wallOptions.cardBgColour"</span> <span class="attribute">cardtxtcolor</span>=<span class="value">"wall.wallOptions.cardForeColour"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 2. Masonry --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-switch-when</span>=<span class="value">"2"</span> <span class="attribute">card</span> <span class="attribute">ng-repeat</span>=<span class="value">"status in wall.statuses"</span> <span class="attribute">open</span>=<span class="value">"wall.open"</span> <span class="attribute">data</span>=<span class="value">"status"</span> </span><br><span class="line">            <span class="attribute">cardbgcolor</span>=<span class="value">"wall.wallOptions.cardBgColour"</span> <span class="attribute">cardtxtcolor</span>=<span class="value">"wall.wallOptions.cardForeColour"</span></span><br><span class="line">            <span class="attribute">leaderboardEnabled</span>=<span class="value">"&#123;&#123;wall.wallOptions.showStatistics&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 3. Single --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-switch-when</span>=<span class="value">"3"</span> <span class="attribute">coa</span> <span class="attribute">ng-repeat</span>=<span class="value">"status in wall.statuses"</span> <span class="attribute">open</span>=<span class="value">"wall.open"</span> <span class="attribute">data</span>=<span class="value">"status"</span></span><br><span class="line">            <span class="attribute">cardbgcolor</span>=<span class="value">"wall.wallOptions.cardBgColour"</span> <span class="attribute">cardtxtcolor</span>=<span class="value">"wall.wallOptions.cardForeColour"</span></span><br><span class="line">            &gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>We pass the saved wall options into each directive using the attributes cardbgcolor, cardtxtcolor, and we use ng-style to evaluate the expression with wallBgColour.</p>
<p>In the linear layout directive file, we use the ‘=’ sign to signal 2-way-binding.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">linearLayoutDirective</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    scope: &#123;</span><br><span class="line">      data: <span class="string">'='</span>,</span><br><span class="line">      cardbgcolor:<span class="string">'='</span>,</span><br><span class="line">      cardtxtcolor:<span class="string">'='</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    templateUrl: <span class="string">'wall/templates/linear.html'</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Then we can use it in our template (linear.html):<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"linear linear-simple"</span> <span class="attribute">style</span>=<span class="value">"background-color: &#123;&#123;cardbgcolor&#125;&#125;;"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Main content --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">p</span> <span class="attribute">class</span>=<span class="value">"linear-content-text"</span> <span class="attribute">style</span>=<span class="value">"color:&#123;&#123;cardtxtcolor&#125;&#125;"</span> <span class="attribute">ng-class</span>=<span class="value">"data.images.length&gt;0?'col-xs-9':'col-xs-12'"</span> <span class="attribute">ng-bind-html</span>=<span class="value">"data.text | tweetTextLink:cardbgcolor | tweetMention:cardbgcolor | tweetHashtag:cardbgcolor | toTrusted"</span>&gt;</span><span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>I have passed the cardbgcolour into the filter <code>| tweetTextLink:cardbgcolor</code> so we can also change the colours of the links:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">filtersModule.filter(<span class="string">'tweetTextLink'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">input, cardBgColour</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> textClassName = cardBgColour ? colourCalculator(hexToRgb(cardBgColour)) : <span class="string">''</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Have fun customizing your walls at: <a href="http://loklak-wall.herokuapp.com" target="_blank" rel="external">loklak-wall.herokuapp.com</a><br><img class="alignnone size-medium wp-image-3459" src="http://blog.loklak.net/wp-content/uploads/2016/07/Screenshot-2016-07-10-09.25.14-700x391.png" alt="Screenshot 2016-07-10 09.25.14" width="700" height="391"></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/02/Manual-Moderation-multiple-users/" itemprop="url">
                  Manual Moderation - multiple users 
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Posted on
            <time itemprop="dateCreated" datetime="2016-07-02T09:41:53+08:00" content="2016-07-02">
              2016-07-02
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/07/02/Manual-Moderation-multiple-users/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/02/Manual-Moderation-multiple-users/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>This is the final post on the <a href="https://loklaknet.wordpress.com/2016/06/23/loklak-walls-manual-moderation-approving-tweets/" target="_blank" rel="external">manual moderation </a>feature, where we will cover how to deal with the case of multiple users logged in moderating or viewing the same wall. The problem was that whenever two pages of the wall were open at the same time, there was no way to tell if another page was polling for tweets, so there would be duplicate tweets added to the database, which would then show up on both walls. This had to be solved as it is expected to have multiple displays or moderators for each wall.</p>
<p>To solve this, we needed to be able to store the user-wall id that was currently polling from the server. Not only did an open page have to check if there was another page polling, but also when the page was closed, the store would have to remove the user-wall id, so that when another open page checked it could start polling and store it’s user-wall id.</p>
<p>This connecting and disconnecting behavior can be detected through websocket events, and socket.io has a convenient way for us to listen to these events on the server:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> server = express();</span><br><span class="line"><span class="keyword">var</span> s = http.createServer(server);</span><br><span class="line"><span class="keyword">var</span> io = <span class="built_in">require</span>(<span class="string">'socket.io'</span>)(s);</span><br><span class="line"><span class="keyword">var</span> pollingWalls = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> clientIds = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">io.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">socket</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create and join UserwallId room when user opens page</span></span><br><span class="line">socket.on(<span class="string">'create'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">userWallId</span>) </span>&#123;</span><br><span class="line">  socket.join(userWallId);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// When close window, use the socket.id to remove from maps so another poll can pass</span></span><br><span class="line">socket.on(<span class="string">'disconnect'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> clientWallPolls = clientIds[socket.id];</span><br><span class="line">  clientWallPolls.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">wallId</span>)</span>&#123;</span><br><span class="line">    pollingWalls[wallId] = <span class="literal">null</span>;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">delete</span> clientIds[socket.id];</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Check duplicate, start if no one else polling</span></span><br><span class="line">socket.on(<span class="string">'checkDup'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> clients_in_the_room = io.sockets.adapter.rooms[data.userWallId]; </span><br><span class="line">  <span class="keyword">var</span> isNoOneElsePolling = pollingWalls[data.userWallId] === socket.id || !pollingWalls[data.userWallId];</span><br><span class="line">  <span class="keyword">if</span>(clients_in_the_room)&#123;</span><br><span class="line">    <span class="keyword">var</span> result = clients_in_the_room.length === <span class="number">1</span> || isNoOneElsePolling;</span><br><span class="line">    <span class="keyword">var</span> responseEmit = <span class="string">'checkDupSuccess'</span>+ data.userWallId+ data.socketId;</span><br><span class="line">    socket.emit(responseEmit, result);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Start polling and mark poller </span></span><br><span class="line"><span class="comment">// Pre-cond: no one else polling / previous poller leaves</span></span><br><span class="line">socket.on(<span class="string">'addPollingWalls'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">userWallId</span>)</span>&#123;</span><br><span class="line">  pollingWalls[userWallId] = socket.id;</span><br><span class="line">  <span class="keyword">var</span> clientWalls = clientIds[socket.id];</span><br><span class="line">  <span class="keyword">if</span>(clientWalls.indexOf(userWallId) === -<span class="number">1</span>)&#123;</span><br><span class="line">    clientWalls.push(userWallId);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>I have pasted the server events(above) and client events(below) so that it is easier to view and explain:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ... other config </span></span><br><span class="line">  socket.emit(<span class="string">'create'</span>, $stateParams.user + $stateParams.id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Timeout that checks for multiple users on the same wall</span></span><br><span class="line">vm.update2 = <span class="function"><span class="keyword">function</span>(<span class="params">refreshTime</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> $timeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    socket.emit(<span class="string">'checkDup'</span>, &#123;userWallId:userWallId, socketId:socketId&#125;);</span><br><span class="line">  &#125;, refreshTime);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Event listener that polls if there are no duplicates </span></span><br><span class="line">socket.on(<span class="string">'checkDupSuccess'</span>+userWallId+socketId, <span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(result)&#123;</span><br><span class="line">    SearchService.initData(searchParams).then(successCb, errorCb);</span><br><span class="line">    socket.emit(<span class="string">'addPollingWalls'</span>, userWallId);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>In server.js, we use two objects - <code>pollingWall</code>‘ to map the walls that are currently polling to the userId, and <code>clientId</code>‘ to map each user to the walls that has the user has opened, so we do not have to traverse the whole object.</p>
<p>We also use <a href="http://socket.io/docs/rooms-and-namespaces/" target="_blank" rel="external">socket.io<code>room</code></a> to check if there is no one else polling on the same wall.<code>socket.join</code> allows the connected user to join an existing room or create one if it does not exist. Each room is marked by their user-wall id. In the client code, (in wallDisplay.js the controller for the wall display page), the <code>create</code>‘ event is emitted when a user opens a wall.</p>
<p>The other 2 event listeners on the server are to check if there are duplicate users.</p>
<p>Before each polling interval, in the timeout function below, the <code>checkDup</code>‘ event is emitted, carrying with it the userwallId and the socketId. The event listener on server (as seen above) checks if there are no other users in the room with <code>io.sockets.adapter.rooms[data.userWallId]</code> or nobody polling <code>var isNoOneElsePolling = pollingWalls[data.userWallId] === socket.id || !pollingWalls[data.userWallId];</code>. It then emits an event <code>checkDupSuccess</code> carrying the boolean result to the specific <code>socket.id</code> of the client that requested the check.</p>
<p>If the check passes then the angular <code>SearchService</code> is called, and another event <code>addPollingWall</code>‘ is emitted to store the <code>userWallId</code> and associate it with the client’s socket.id in the <code>pollingWall</code>‘ and <code>clientId</code>‘ object.</p>
<p>Create your own walls at: <a href="http://loklak-wall.herokuapp.com" target="_blank" rel="external">loklak-wall.herokuapp.com</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/30/Bubble-Bar-charts-for-loklak/" itemprop="url">
                  Bubble & Bar charts for loklak
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Posted on
            <time itemprop="dateCreated" datetime="2016-06-30T09:24:37+08:00" content="2016-06-30">
              2016-06-30
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/06/30/Bubble-Bar-charts-for-loklak/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/06/30/Bubble-Bar-charts-for-loklak/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>I have made 2 visualisations in the front-end apps section using D3.js and AngularJS, that anyone can use on loklak.org or locally.</p>
<p>The first type is a bubble chart, these are great for representing single values, such as the number of mentions or the frequency of certain words.</p>
<p>As you can see, when I search for the term loklak, one can see the number of times a user was mentioned and the relative frequency of words.<img class="alignnone size-full wp-image-163" src="http://blog.loklak.net/wp-content/uploads/2016/05/screenshot-2016-05-30-10-55-26.png" alt="Screenshot 2016-05-30 10.55.26" width="1268" height="490"></p>
<p>First, I had to solve the problem of getting the data. This can be done through the data service used for the <a href="https://loklaknet.wordpress.com/2016/05/22/a-tweet-feed-for-loklak-org/" target="_blank" rel="external">tweet feed previously</a>. This gives us an updated array of tweet objects in the local storage of the browser.</p>
<p>Next, I had to analyse the tweets. True to its name, D3.js handles a wide variety of data formats, so storing term-frequency pairs in an object is sufficient. Do take a look at the <a href="https://github.com/loklak/loklak_server/blob/master/html/apps/barchart/services/analyticService.js" target="_blank" rel="external">code</a> if you are interested. The processed data is then stored in a separate array in local storage, for eg $storage.mentionFreq instead of $storage.tweets.</p>
<p>Next, I had to display the processed data. Thankfully, angularJS plays nicely with d3.js, so to create a directive in angular, I could use similar D3.js code in the $link function of the directive, as I was manipulating DOM elements with D3.js.</p>
<p>Finally, to make the chart update itself without a page refresh, I added a $watch function on the processed data in the local storage, which runs an update function. Within it, D3.js then uses <a href="https://bost.ocks.org/mike/join/" target="_blank" rel="external">array joins</a> to render the new data with .data(), so it seamlessly updates itself. Do take a look at the <a href="https://github.com/loklak/loklak_server/blob/master/html/apps/barchart/charts/bubbleCloud.js" target="_blank" rel="external">code</a> for the directives for a more in-depth explanation.</p>
<p>The beauty of directives is that they are components which are reusable, the above example is actually using the same directive but with different attributes passed in.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-controller</span>=<span class="value">'bubbleCloudCtrl'</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">bubble-cloud</span> <span class="attribute">flex</span> <span class="attribute">data</span>=<span class="value">"$storage.mentionFreq"</span> <span class="attribute">min</span> =<span class="value">"1"</span> <span class="attribute">title</span>=<span class="value">"Most Mentions"</span>&gt;</span><span class="tag">&lt;/<span class="title">bubble-cloud</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">bubble-cloud</span> <span class="attribute">flex</span> <span class="attribute">data</span>=<span class="value">"$storage.wordFreq"</span> <span class="attribute">min</span>=<span class="value">"3"</span> <span class="attribute">title</span>=<span class="value">"Word Frequency"</span>&gt;</span><span class="tag">&lt;/<span class="title">bubble-cloud</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>The same pattern can be applied to other D3.js charts, below we can see a stacked bar chart example using the general pattern as described above:</p>
<p><img class="alignnone size-full wp-image-165" src="http://blog.loklak.net/wp-content/uploads/2016/05/screenshot-2016-05-30-10-55-19.png" alt="Screenshot 2016-05-30 10.55.19.png" width="1082" height="614"></p>
<p>The difference is in <a href="https://github.com/loklak/loklak_server/blob/master/html/apps/barchart/services/analyticService.js" target="_blank" rel="external">analaytics</a> and <a href="https://github.com/loklak/loklak_server/blob/master/html/apps/barchart/charts/barChart.js" target="_blank" rel="external">directive</a> code, which is a bit more involved, as I had to process by date, and then by quantity.</p>
<p>Hopefully this helps future developers to make their own, some ideas I have are making radar and force directed graph.</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/23/Manual-Moderation-approving-tweets/" itemprop="url">
                  Manual Moderation - approving tweets
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Posted on
            <time itemprop="dateCreated" datetime="2016-06-23T09:40:52+08:00" content="2016-06-23">
              2016-06-23
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/06/23/Manual-Moderation-approving-tweets/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/06/23/Manual-Moderation-approving-tweets/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>This is a continuation from the previous post - <a href="https://loklaknet.wordpress.com/2016/06/17/loklak-walls-manual-moderation-tweet-storage/" target="_blank" rel="external">Loklak walls manual moderation - tweet storage</a>. In this section, I will show the changes I made to enable the user to approve or reject a tweet, and make that change happen across all walls that are opened.</p>
<p>First, I had to examine how loklak.net displays it’s tweets previously. On each wall page, a timeout would be called every interval to retrieve new tweets from loklak_server, these tweets would then be stored on the client’s browser window, in the view model, or $scope in angular.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vm.update2 = <span class="function"><span class="keyword">function</span>(<span class="params">refreshTime</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> $timeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    SearchService.initData(searchParams).then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">      vm.statuses = data.statuses.splice(<span class="number">0</span>, searchParams.count);</span><br><span class="line">    ...</span><br><span class="line">    &#125;, refreshTime);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Having this kind of storage for each browser makes the data inconsistent across the same wall open in different browser windows, as they start querying loklak_server at different times and intervals. This also makes it tough to implement manual moderation previously as the tweets on each open page could not be controlled from the dashboard, since they all lived in their own page.</p>
<p>Now that we have shifted the storage of tweets to mongoDB, we are now able to control how tweets are displayed for all open walls! First, I shifted the calls to loklak_server to the dashboard page instead of the walls page as it made more sense to control the interval from the dashboard rather than the display pages themselves.</p>
<p>Next, I needed a way to sync changes in the database across the dashboard as well as the display pages. At first, I tried to use the same method of http calls, but I soon found them too complicated to sync, having 3 components with interconnected actions. Actions from the dashboard and new entries from the database would have to affect the display, and new entries from the database would have to affect the dashboard and display. Also having an interval for updating the wall after changes were made to the database made it seem very unresponsive and resulted in a bad user experience.</p>
<p>The solution to this was: WebSockets! This allows us to listen for new events like addition of new tweets. When first initialized, the display pages and the dashboard just had to load the existing tweets in the database, when new tweets are loaded, they’ll be added into the database AND the displays and dashboard, making it update in real time.</p>
<p><span style="line-height:1.7"><img class="alignnone  wp-image-2432" src="http://blog.loklak.net/wp-content/uploads/2016/06/websocket-small.jpg" alt="websocket-small" width="224" height="249"></span></p>
<p><span style="line-height:1.7">I chose socket.io as it made integrating WebSockets into the MEAN stack relatively easy. After the http request for new tweets from loklak server is returned, the app then sends a POST request to the node server, which then emits an event to update the display and the dashboard. Below is the route controller, which posts the tweet array received from loklak server.</span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports.storeTweet = <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line"> req.body.tweetArr.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">tweet</span>)</span>&#123;</span><br><span class="line">   <span class="keyword">var</span> newTweet = <span class="keyword">new</span> Tweet(tweet);</span><br><span class="line">     newTweet.save(<span class="function"><span class="keyword">function</span>(<span class="params">err,tweet</span>)</span>&#123;</span><br><span class="line">     <span class="comment">// EMIT DASHBOARD EVENT</span></span><br><span class="line">     io.emit(<span class="string">"addNewTweet"</span>, tweet);</span><br><span class="line">     <span class="comment">// EMIT WALL DISPLAY EVENT</span></span><br><span class="line">     io.emit(<span class="string">"addNewTweet"</span>+req.body.userWallId, tweet);</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>
<p>On the wall display page controller, it listens for the emitted event and adds the data to the display.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> socket.on(<span class="string">'addNewTweets'</span> + $stateParams.user + $stateParams.id, <span class="function"><span class="keyword">function</span>(<span class="params">tweet</span>)</span>&#123;</span><br><span class="line">  vm.statuses.splice(<span class="number">0</span>,<span class="number">0</span>, tweet);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>The toggle events are similar in that instead of POST requests,  now we are sending PUT requests from the dashboard to update the tweet in mongoDB, and then changing the data attribute on the wall display. Using AngularJS’s ng-hide we can show/hide the tweet depending on it’s approval field.</p>
<p>Inside the angular directive on the dashboard we attach a toggle function to the click:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$scope.toggle = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  $scope.data.approval = !$scope.data.approval;</span><br><span class="line">  $http.put(<span class="string">'/api/tweets/'</span>+$scope.data._id, $scope.data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-show</span>=<span class="value">"data.approval"</span> <span class="attribute">ng-attr-id</span>=<span class="value">"&#123;&#123;data.id_str&#125;&#125;"</span> <span class="attribute">class</span>=<span class="value">"linear linear-simple"</span> /&gt;</span>;</span><br></pre></td></tr></table></figure>
<p>Similarly on the server we emit an event:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports.updateTweet = <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line"> Tweet</span><br><span class="line"> .findById(req.params.tweetId)</span><br><span class="line"> .exec(<span class="function"><span class="keyword">function</span>(<span class="params">err, tweet</span>) </span>&#123;</span><br><span class="line">    tweet.approval = !tweet.approval;</span><br><span class="line">    tweet.save(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">       res.json(&#123;tweet: tweet&#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"> &#125;);</span><br><span class="line"></span><br><span class="line"> <span class="comment">// EMIT TOGGLE EVENT</span></span><br><span class="line"> io.emit(<span class="string">"toggle"</span>, req.params.tweetId);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>And on the wallDisplay controller we can listen to that toggle event:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">socket.on(<span class="string">'toggle'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">tweetId</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> tweetIdx = vm.statuses.findIndex(<span class="function"><span class="keyword">function</span>(<span class="params">tweet</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> tweet._id === tweetId;</span><br><span class="line">  &#125;);</span><br><span class="line">  vm.statuses[tweetIdx].approval = !vm.statuses[tweetIdx].approval;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>The end result is manual moderation from the dashboard!</p>
<p><img class="alignnone size-full wp-image-2485" src="http://blog.loklak.net/wp-content/uploads/2016/06/iclfu4kze9.gif" alt="icLfu4KZE9" width="1438" height="823"></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/11/Protecting-API-routes-using-JWTs/" itemprop="url">
                  Protecting API routes using JWTs
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Posted on
            <time itemprop="dateCreated" datetime="2016-06-11T09:33:02+08:00" content="2016-06-11">
              2016-06-11
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/06/11/Protecting-API-routes-using-JWTs/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/06/11/Protecting-API-routes-using-JWTs/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>Signing in locally is great but what we want is to make sure the right person has access to the right routes. This was done for the loklak user walls, as we have to check if the user is signed in and is authorized to see the current walls, and edit them.</p>
<h2 id="Server-side-protecting-routes"><a href="#Server-side-protecting-routes" class="headerlink" title="Server side - protecting routes"></a>Server side - protecting routes</h2><p>To verify the identity of the logged in user we have to check for the JWT. To setup and use the route authentication we use express-jwt as middleware, which checks if the JWT is present before going to the route.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jwt = <span class="built_in">require</span>(<span class="string">'express-jwt'</span>);</span><br><span class="line"><span class="keyword">var</span> config = <span class="built_in">require</span>(<span class="string">'../../custom_configFile.json'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> auth = jwt(&#123;</span><br><span class="line"> secret: config.jwtsecret,</span><br><span class="line"> userProperty: <span class="string">'payload'</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ctrlAuth = <span class="built_in">require</span>(<span class="string">'../controllers/authentication'</span>);</span><br><span class="line"><span class="keyword">var</span> ctrlMailer = <span class="built_in">require</span>(<span class="string">'../controllers/email'</span>);</span><br><span class="line"><span class="keyword">var</span> ctrlWalls = <span class="built_in">require</span>(<span class="string">'../controllers/walls'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// WALL API</span></span><br><span class="line">router.get (<span class="string">'/:user/:app/:id'</span>, ctrlWalls.getWallById);</span><br><span class="line">router.get (<span class="string">'/:user/:app'</span>, auth, ctrlWalls.getUserWalls);</span><br><span class="line">router.post (<span class="string">'/:user/:app'</span>, auth, ctrlWalls.createWall);</span><br><span class="line">router.put (<span class="string">'/:user/:app/:id'</span>, auth, ctrlWalls.updateWall);</span><br><span class="line">router.delete(<span class="string">'/:user/:app/:id'</span>, auth, ctrlWalls.deleteWall);</span><br></pre></td></tr></table></figure>
<p>Notice that we do not use authentication for the wall route as we want anyone to be able to access the wall.</p>
<p>The route controllers then handle manipulating the mongoose user models. We check for the JWT payload in the getUserWalls controller but not the getWallById controller.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports.getWallById = <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line"> User</span><br><span class="line"> .findById(req.params.user)</span><br><span class="line"> .exec(<span class="function"><span class="keyword">function</span>(<span class="params">err, user</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (user.apps[req.params.app]) &#123;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; user.apps[req.params.app].length; i = i + <span class="number">1</span>) &#123;</span><br><span class="line">     <span class="keyword">if</span> (user.apps[req.params.app][i].id === req.params.id) &#123;</span><br><span class="line">       <span class="keyword">return</span> res.jsonp(user.apps[req.params.app][i]);</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   res.jsonp(&#123;&#125;);</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   res.jsonp(&#123;&#125;);</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports.getUserWalls = <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line"> <span class="comment">// If no user ID exists in the JWT return a 401 </span></span><br><span class="line"> <span class="keyword">if</span> (!req.payload._id) &#123;</span><br><span class="line">   res.status(<span class="number">401</span>).json(&#123;</span><br><span class="line">     message : UnauthorizedError: private wall page</span><br><span class="line">   &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   User</span><br><span class="line">   .findById(req.params.user)</span><br><span class="line">   .exec(<span class="function"><span class="keyword">function</span>(<span class="params">err, user</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (user.apps &amp;&amp; user.apps[req.params.app]) &#123;</span><br><span class="line">       res.jsonp(user.apps[req.params.app]);</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       res.jsonp([]);</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;); </span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>One error I got stuck on was the <code>Mongoose: TypeError: doc.validate is not a function</code>, in the update and delete methods. Mutating the array with splice instead of assigning it a new object solves this.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// x</span></span><br><span class="line"><span class="comment">// appData[req.params.app][i] = req.body;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// √</span></span><br><span class="line">appData[req.params.app].splice(i, <span class="number">1</span>, req.body);</span><br></pre></td></tr></table></figure>
<h3 id="Model-Schema"><a href="#Model-Schema" class="headerlink" title="Model Schema"></a>Model Schema</h3><p>I have chosen to embed the wall options into the User model schema itself instead of creating another collection, as it is one user-few walls, so there would be lesser queries to the API as there’s mostly reading wall options, and relatively less updating of wall options.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> UserSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line"> email: &#123; type: <span class="built_in">String</span>, unique: <span class="literal">true</span>, required: <span class="literal">true</span> &#125;,</span><br><span class="line"> name: &#123; type: <span class="built_in">String</span>, required: <span class="literal">true</span> &#125;,</span><br><span class="line"> hash: <span class="built_in">String</span>,</span><br><span class="line"> salt: <span class="built_in">String</span>,</span><br><span class="line"> isVerified: &#123; type: <span class="built_in">Boolean</span>, required: <span class="literal">true</span> &#125;,</span><br><span class="line"> apps: &#123;</span><br><span class="line"> wall: [&#123;</span><br><span class="line"> profanity: <span class="built_in">Boolean</span>,</span><br><span class="line">   ...</span><br><span class="line"> &#125;]</span><br><span class="line"> &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Client-side-consuming-the-API"><a href="#Client-side-consuming-the-API" class="headerlink" title="Client side - consuming the API."></a>Client side - consuming the API.</h2><p>We use $resource, a factory built on $http, to interact with the routes, through an angular service.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AppsService</span>(<span class="params">$q, $http, $resource, AppSettings, AuthService</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">return</span> $resource(<span class="string">'/api/:user/:app/:id'</span>, &#123;</span><br><span class="line">   user: <span class="string">'@user'</span>,</span><br><span class="line">   app: <span class="string">'@app'</span>,</span><br><span class="line">   id: <span class="string">'@id'</span></span><br><span class="line">  &#125;, &#123;</span><br><span class="line">  query: &#123;</span><br><span class="line">   method: <span class="string">'GET'</span>,</span><br><span class="line">   isArray: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  save: &#123;</span><br><span class="line">   method: <span class="string">'POST'</span>,</span><br><span class="line">   transformRequest: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">delete</span> data.user;</span><br><span class="line">     <span class="keyword">delete</span> data.app;</span><br><span class="line">     <span class="keyword">delete</span> data.showLoading;</span><br><span class="line">     <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(data);</span><br><span class="line">   &#125;,</span><br><span class="line">   params: &#123;</span><br><span class="line">     user: <span class="string">'@user'</span>,</span><br><span class="line">     app: <span class="string">'@app'</span>,</span><br><span class="line">     id: <span class="string">'@id'</span></span><br><span class="line">   &#125;</span><br><span class="line">  &#125;, ...</span><br></pre></td></tr></table></figure>
<p>Then in our controller, WallCtrl, we use this service, for eg:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">if</span> ($scope.isLoggedIn) &#123;</span><br><span class="line">  $scope.userWalls = AppsService.query(&#123;</span><br><span class="line">   user: $scope.currentUser._id,</span><br><span class="line">   app: <span class="string">'wall'</span></span><br><span class="line"> &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ($scope.userWalls.length === <span class="number">0</span>) &#123;</span><br><span class="line">   $scope.wallsPresent = <span class="literal">false</span>;</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure>
<p>To attach the JWT in the header we will get the JWT from local storage and attach it using an httpInterceptor through the client side routes which uses UI-router. If you do not do this you will get the UnauthorizedError, as no token is found.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tokenInjectorService</span>(<span class="params">$window</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">var</span> tokenInjector = &#123;</span><br><span class="line">	request: <span class="function"><span class="keyword">function</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">		 config.headers[<span class="string">'Authorization'</span>] = <span class="string">'Bearer '</span>+ $<span class="built_in">window</span>.localStorage[<span class="string">'jwt-token'</span>];</span><br><span class="line">		 <span class="keyword">return</span> config;</span><br><span class="line"> 	&#125;</span><br><span class="line"> &#125;;</span><br><span class="line"> <span class="keyword">return</span> tokenInjector;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Routes</span>(<span class="params">$stateProvider, $locationProvider, $httpProvider</span>) </span>&#123;</span><br><span class="line">	$locationProvider.html5Mode(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">	$stateProvider</span><br><span class="line">	.state(<span class="string">'Home'</span>, &#123;</span><br><span class="line">		url: <span class="string">'/'</span>,</span><br><span class="line">		controller: <span class="string">'MapCtrl as map'</span>,</span><br><span class="line">		templateUrl: <span class="string">'home.html'</span>,</span><br><span class="line">		title: <span class="string">'Home'</span></span><br><span class="line">	&#125;) <span class="comment">// and other routes</span></span><br><span class="line"></span><br><span class="line">	$httpProvider.interceptors.push(<span class="string">'tokenInjector'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Hope that helps anyone who has trouble with their MEAN app and JWT auth.</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/default_avatar.jpeg" alt="Leon Mak" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Leon Mak</p>
        </div>
        <p class="site-description motion-element" itemprop="description"></p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">26</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">categories</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">33</span>
              <span class="site-state-item-name">tags</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/rss2.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/leonmak" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Leon Mak</span>
</div>
<!--
<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>
-->


      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    
    

  

    <script type="text/javascript">
      var disqus_shortname = 'leonmak-me';
      var disqus_identifier = 'page/2/index.html';
      var disqus_title = '';
      var disqus_url = '';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
    </script>
  


  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
